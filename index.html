<!DOCTYPE html>
<html lang="zh-CN">
<head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
    <title>
        
            LEARN
        
    </title>
    <link rel="icon" href="/img/favicon.png"/>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <link rel="stylesheet" href="/css/hljs.min.css">
    <script src="/js/hljs.min.js"></script>  
    <script src="/js/gitment.browser.js"></script>  
</head>
<body>
    <header class="header" id="header">
    <h1>
        <a class="title" href="/">
            LEARN
        </a>
    </h1>
    <h2>
        <a class="motto">
            Learn More Think More
        </a>
    </h2>
    <nav class="navbar">
        <ul class="menu">
            
            
                <li class="menu-item">
                    <a href="/" class="menu-item-link">
                        Home
                    </a>
                </li>
            
                
            
                <li class="menu-item">
                    <a href="/archives/" class="menu-item-link">
                        Archives
                    </a>
                </li>
            
                
            
                <li class="menu-item">
                    <a href="/about/" class="menu-item-link">
                        About
                    </a>
                </li>
            
                
            
                <li class="menu-item">
                    <a href="https://github.com/superDJM/" class="menu-item-link">
                        Github
                    </a>
                </li>
            
                
            
                <li class="menu-item">
                    <a href="/atom.xml" class="menu-item-link">
                        RSS
                    </a>
                </li>
            
                
            
                
                
                <li class="menu-item">
                    <a class="menu-item-link search">
                        Search                   
                        <i class="fa fa-long-arrow-right search-icon" aria-hidden="true"></i>
                    </a>
                        <input placeholder="Search..." class="search-input" style="display:none;border:none!important;" onkeydown="onEnter(event)" onkeypress="onEnter(event)"></input>
                </li>
                
        </ul>
    </nav>
</header>
    <main class="main">
        <section class="posts">
    
        <article class="post">
            <h1>
                <a class="title" href="/2017/12/29/关于我/"> 
                    关于我 
                </a>
            </h1>
                        <div class="meta">
                <a class="date"> 
                    <i class="fa fa-calendar" aria-hidden="true"></i>                    
                    2017-12-29   
                </a>
                
                
                
                    
            </div>
            <div class="content">
                
                
                
            </div>
            <div class="continue">
            <a href="/2017/12/29/关于我/">
            Continue            <i class="fa fa-angle-right" aria-hidden="true"></i>
            </a>
            </div>
        </article>
        
        <article class="post">
            <h1>
                <a class="title" href="/2017/01/06/make-gitignore-e7-ab-8b-e5-8d-b3-e7-94-9f-e6-95-88/"> 
                    Make the .gitignore file work immediately 
                </a>
            </h1>
                        <div class="meta">
                <a class="date"> 
                    <i class="fa fa-calendar" aria-hidden="true"></i>                    
                    2017-01-06   
                </a>
                
                <a class="category">
                    <i class="fa fa-th" aria-hidden="true"></i>  
                </a>
               
                <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/GIT/">GIT</a></li></ul>
                
                    
            </div>
            <div class="content">
                
                <p>用过idea或者其他ide的人都知道。如果不想让一些test文件，或者ide配置文件一起上传到项目当中，我们用.gitignore来忽略这些文件。</p>
<p>但是有时候你会发现，没有建.gitignore之前，那些需要忽略的文件已经提交了，这时，即使把新建的.gitignore文件提交了，也无法让已经上传上去的文件撤下来。</p>
<p>我们可以用下面简单的三行命令解决这个问题，核心思想就是重新add。</p>
<pre><code>git rm -r --cached .
git add .
git commit -m &#39;update .gitignore&#39;
</code></pre><div class="line number1 index0 alt2"></div>
                
            </div>
            <div class="continue">
            <a href="/2017/01/06/make-gitignore-e7-ab-8b-e5-8d-b3-e7-94-9f-e6-95-88/">
            Continue            <i class="fa fa-angle-right" aria-hidden="true"></i>
            </a>
            </div>
        </article>
        
        <article class="post">
            <h1>
                <a class="title" href="/2016/10/30/apache-segmentation-fault/"> 
                    apache segmentation fault 
                </a>
            </h1>
                        <div class="meta">
                <a class="date"> 
                    <i class="fa fa-calendar" aria-hidden="true"></i>                    
                    2016-10-30   
                </a>
                
                <a class="category">
                    <i class="fa fa-th" aria-hidden="true"></i>  
                </a>
               
                <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/杂记/">杂记</a></li></ul>
                
                    
            </div>
            <div class="content">
                
                <p>今天外包的一个项目突然崩了，显示“服务器未发送任何数据”（<strong>err empty response</strong>），之前遇到这种情况一般是自己的代码写错了，然后<strong>没有正常输出数据</strong>。但是代码上线一年多，而且都由我来维护，不可能是代码的问题。</p>
<p>首先ping域名发现ip是对的而且能ping通，那就排除了服务器域名dns的问题。</p>
<p>然后登上服务器，第一步先用<strong>top</strong>，发现负载为0，内存、io也木有问题。</p>
<p>第二步检查一下apache的状态，发现进程正常运行，端口也正常绑定。所以直接先重启apache。</p>
<pre><code>ps aux | grep &quot;httpd&quot;//查看进程

netstat -an | grep &quot;:80&quot;//查看网络监听

/etc/init.d/httpd restart //重启apache`&lt;/pre&gt;
然后网站就能正常访问了。**基本确定是apache的问题了。**

于是第三步从apache的日志入手。
&lt;pre class=&quot;pure-highlightjs&quot;&gt;`tail -f /etc/httpd/logs/error_log
`&lt;/pre&gt;
结果如下图，出现一大堆的segmentation fault，也是本文的标题。

[![apache segmentation fault](http://blog.djmgod.cn/wp-content/uploads/2016/10/QQ图片20161030204012-300x82.png)](http://blog.djmgod.cn/2016/10/apache-segmentation-fault.html/qq%e5%9b%be%e7%89%8720161030204012)

上网google了一下，比较靠谱的说法是因为**php的zend模块**引起的。

我确实部署了一个xcache来加速php，于是去他的bug report里面找，终于发现有类似的bug爆出。**还发现使用了加速php这类的zend扩展都会有引起apache段错误的问题**。

最后我**卸载了xcache**，然后业务暂时回复正常。

**我的思考：**由于xcache+PHP+Apache这个方案已经运行了一年多了，期间也只是出现xcache的oom问题，所以我怀疑问题可能不是出自xcache，或者还有其他的原因，如果要追根到底的话，可以对httpd进行调试，由于是线上环境，而且我的空余时间不是很多，就没有再去尝试了。读者可以自己检验。
&lt;pre class=&quot;pure-highlightjs&quot;&gt;`gdb httpd
</code></pre>
                
            </div>
            <div class="continue">
            <a href="/2016/10/30/apache-segmentation-fault/">
            Continue            <i class="fa fa-angle-right" aria-hidden="true"></i>
            </a>
            </div>
        </article>
        
        <article class="post">
            <h1>
                <a class="title" href="/2016/10/07/static-e7-9a-84-e4-bd-9c-e7-94-a8/"> 
                    static的作用 
                </a>
            </h1>
                        <div class="meta">
                <a class="date"> 
                    <i class="fa fa-calendar" aria-hidden="true"></i>                    
                    2016-10-07   
                </a>
                
                <a class="category">
                    <i class="fa fa-th" aria-hidden="true"></i>  
                </a>
               
                <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/c-c/">c/c++</a></li></ul>
                
                    
            </div>
            <div class="content">
                
                <p>上一篇文章<a href="http://blog.djmgod.cn/2016/10/c%e7%9a%845%e7%a7%8d%e5%82%a8%e5%ad%98%e7%b1%bb.html" target="_blank" rel="noopener">c的5种储存类</a>有说到static，这篇文章总结一下static的作用。</p>
<p>static关键字至少有下列n个作用：<br>（1）设置变量的存储域，函数体内static变量的作用范围为该函数体，不同于auto变量，该变量的内存只被分配一次，因此其值在下次调用时仍维持上次的值；</p>
<p>（2）限制变量的作用域，在模块内的static全局变量可以被模块内所用函数访问，但不能被模块外其它函数访问；</p>
<p>（3）限制函数的作用域，在模块内的static函数只可被这一模块内的其它函数调用，这个函数的使用范围被限制在声明它的模块内；</p>
<p>以下是C++对static的扩展<br>（4）在类中的static成员变量意味着它为该类的所有实例所共享，也就是说当某个类的实例修改了该静态成员变量，其修改值为该类的其它所有实例所见；<br>（5）在类中的static成员函数属于整个类所拥有，这个函数不接收this指针，因而只能访问类的static成员变量。</p>

                
            </div>
            <div class="continue">
            <a href="/2016/10/07/static-e7-9a-84-e4-bd-9c-e7-94-a8/">
            Continue            <i class="fa fa-angle-right" aria-hidden="true"></i>
            </a>
            </div>
        </article>
        
        <article class="post">
            <h1>
                <a class="title" href="/2016/10/06/c-e7-9a-845-e7-a7-8d-e5-82-a8-e5-ad-98-e7-b1-bb/"> 
                    c的5种储存类 
                </a>
            </h1>
                        <div class="meta">
                <a class="date"> 
                    <i class="fa fa-calendar" aria-hidden="true"></i>                    
                    2016-10-06   
                </a>
                
                <a class="category">
                    <i class="fa fa-th" aria-hidden="true"></i>  
                </a>
               
                <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/杂记/">杂记</a></li></ul>
                
                    
            </div>
            <div class="content">
                
                <p>在c语言里面，用于储存程序数据的内存可用存储时期、作用域、链接来表征。</p>
<p>储存时期可以是静态的、自动的或者分配的。如果是静态的，内存在程序开始执行的时候被分配，并在程序运行时一直存在。如果是自动的，变量所用的内存在程序执行到该变量定义的 代码块时开始分配，在退出代码时，自动释放。如果是程序员自己分配的（malloc或者其他相关函数）内存，通过free（）释放。<br>作用域决定了哪一部分程序可以访问某个数据。在所有函数之外定义的变量具有问津啊作用域，并对该变量声明之后定义的全部函数可见。在代码块里面定义或者作为函数参数定义的变量具有代码块作用域，并只在该代码块及其子代码块中可见。</p>
<p>链接描述了程序的某个单元定义的变量可被链接到其他的哪些地方。具有代码块作用域的变量作为局部变量，具有空链接。具有文件作用域的变量可有内部链接或外部链接。内部链接意味着变量只可在包含变量定义的文件内部使用，外部链接意味着变量可以在其他文件中使用。</p>
<p>下面是5种存储类：</p>
<p>自动—-在一个代码块内(或在一个函数头部作为参量)声明的变量，无论有没有储存类修饰符auto，都属于自动储存类，该类具有自动储存时期、代码块作用域和空链接。若未经初始化，他的值是不定的。</p>
<p>寄存器—-在一个代码块内(或在一个函数头部作为参量)使用储存类修饰符register声明的变量属于寄存器储存类。把一个变量声明为寄存器变量可以指示编译器提供可用的最快访问（根据系统情况选择存放在寄存器还是高速内存，你无法获取他的地址）。在其他许多方面，和auto类一样。</p>
<p>静态、空链接—-在一个代码块内使用储存类修饰符static声明的变量属于静态空链接储存类。该类拥有静态储存时期、代码块作用域和空链接，仅在编译的时候初始化一次。如未明确初始化，所有的字节都被设定为0.</p>
<p>静态、外部链接—-在所有函数外部定义、未使用static声明的变量属于静态、外部链接储存类。该类拥有静态储存时期、代码块作用域和外部链接，仅在编译的时候初始化一次。如未明确初始化，所有的字节都被设定为0.</p>
<p>静态、内部链接—–在所有函数外部定义、使用了static声明的变量属于静态、外部链接储存类。该类拥有静态储存时期、代码块作用域和外部链接，仅在编译的时候初始化一次。如未明确初始化，所有的字节都被设定为0.</p>
<p>&nbsp;</p>

                
            </div>
            <div class="continue">
            <a href="/2016/10/06/c-e7-9a-845-e7-a7-8d-e5-82-a8-e5-ad-98-e7-b1-bb/">
            Continue            <i class="fa fa-angle-right" aria-hidden="true"></i>
            </a>
            </div>
        </article>
        
        <article class="post">
            <h1>
                <a class="title" href="/2016/10/06/e8-bf-9b-e7-a8-8b-e4-b8-8e-e7-ba-bf-e7-a8-8b/"> 
                    进程与线程 
                </a>
            </h1>
                        <div class="meta">
                <a class="date"> 
                    <i class="fa fa-calendar" aria-hidden="true"></i>                    
                    2016-10-06   
                </a>
                
                <a class="category">
                    <i class="fa fa-th" aria-hidden="true"></i>  
                </a>
               
                <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/c-c/">c/c++</a></li></ul>
                
                    
            </div>
            <div class="content">
                
                <div></div><br><div>面试的时候又问到，自己总结了一下。仅供参考。</div><br><div></div><br><div><strong>进程定义</strong></div><br><div>进程是进程实体的运行过程，是系统仅从资源分配和调度的一个独立单位。</div><br><div><strong>进程几种基本状态</strong></div><br><div>1、就绪</div><br><div>2、阻塞</div><br><div>3、执行</div><br><div><strong>进程转换过程</strong></div><br><div>1、就绪-&gt;执行 进程调度（获得cpu资源和时间片）</div><br><div>2、执行-&gt;就绪 时间片完</div><br><div>3、执行-&gt;阻塞 i/o请求</div><br><div>4、阻塞-&gt;就绪 i/o完成</div><br><div><strong>pcb（Process Control Block）的作用</strong></div><br><div>1、pcb是系统感知进程存在的唯一标志</div><br><div>2、因为进程切换时会把cpu的现场保存在pcb，实现了间断性运行方式</div><br><div>3、保存了进程管理所需要的信息。保存了内存和外存的始址指针、文件、i/o设备等进程运行的全部资源</div><br><div>4、提供进程调度所需要的信息。保存了状态信息、优先级、等待时间、已执行时间等</div><br><div>5、实现与其他进程的同步与通讯。保存了用于同步的信号量、用于进程通讯的区域或通信队列指针等。</div><br><div><strong>pcb存的信息</strong></div><br><div>1、进程标识符</div><br><div>     1、外部标识符 用户自己定义的</div><br><div>     2、内部标识符 os赋予的唯一数字id</div><br><div>2、处理机状态</div><br><div>     1、通用寄存器</div><br><div>     2、指令计数器</div><br><div>     3、程序状态字psw（条件码、执行方式、中断屏蔽标志等）</div><br><div>     4、用户栈指针</div><br><div>3、进程调度信息</div><br><div>     1、进程状态</div><br><div>     2、进程优先级</div><br><div>     3、进程调度算法有关，hrrn（Highest Response Ratio Next）高响应比优先调度算法，需要等待时间、运行时间等参数</div><br><div>     4、事件。是指发生进程转换的原因</div><br><div>4、进程控制信息</div><br><div>     1、程序与数据的地址</div><br><div>     2、同步与通讯的所需的信息，消息队列指针、信号量</div><br><div>     3、资源清单。除cpu外的进程运行所需资源，还有一张已分配给该程序的资源清单</div><br><div>     4、链接指针。下一个进程pcb的首地址。</div><br><div><strong>进程ipc</strong></div><br><div>1、管道</div><br><div>2、消息队列</div><br><div>3、共享内存</div><br><div>4、信号</div><br><div>5、socket</div><br><div><br><br><em> </em> <em><br><br></em></div><br><div><strong>线程与进程的比较</strong></div><br><div>1、线程是调度和分派的基本单位，是能独立运行的基本单位。</div><br><div>2、进程之间可以并发，线程之间也能并发。</div><br><div>3、进程是资源分配的基本单位，线程本身不拥有系统资源，它仅保存了tcb、一组寄存器和栈。同一进程的线程共享相同的地址空间。</div><br><div>4、进程间相互独立，同一进程的各线程间共享。某进程内的线程在其它进程不可见。</div><br><div>5、线程切换和撤销都比进程快。</div><br><div>7、在多线程OS中，进程不是一个可执行的实体。</div><br><div><em>*线程控制块tcb</em></div><br><div>1、线程id</div><br><div>2、一组寄存器，程序计数器PC、状态寄存器、通用寄存器（都是副本）</div><br><div>3、线程运行状态</div><br><div>4、优先级</div><br><div>5、线程专用储存区，用于线程切换时存放cpu现场。</div><br><div>6、信号屏蔽</div><br><div>7、堆栈（栈）指针，局部变量和返回地址。2个指针，一个指向用户栈，一个指向系统栈。</div>
                
            </div>
            <div class="continue">
            <a href="/2016/10/06/e8-bf-9b-e7-a8-8b-e4-b8-8e-e7-ba-bf-e7-a8-8b/">
            Continue            <i class="fa fa-angle-right" aria-hidden="true"></i>
            </a>
            </div>
        </article>
        
        <article class="post">
            <h1>
                <a class="title" href="/2016/09/04/e5-88-86-e5-b8-83-e5-bc-8f-e4-b8-80-e8-87-b4-e6-80-a7-e7-ae-97-e6-b3-95/"> 
                    分布式一致性算法 
                </a>
            </h1>
                        <div class="meta">
                <a class="date"> 
                    <i class="fa fa-calendar" aria-hidden="true"></i>                    
                    2016-09-04   
                </a>
                
                <a class="category">
                    <i class="fa fa-th" aria-hidden="true"></i>  
                </a>
               
                <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/架构/">架构</a></li></ul>
                
                    
            </div>
            <div class="content">
                
                <h3 id="一、强一致性"><a href="#一、强一致性" class="headerlink" title="一、强一致性"></a>一、强一致性</h3><p>R+W&gt;N，建设有3个节点，每次读时，读2个节点并且数据一致；写时，写2个节点都成功才算写成功。这种是强一致性。</p>
<p>2PC，3PC 多个节点都成功时，才算成功，否则进行回滚操作。</p>
<p>PAXOS，类似于2PC,解决分布式系统如何就某个值（决议）达成一致，进行投票选举。是一种无主的节点的算法。分布式的协调服务zookeeper就实现了这个算法，保障一致性。mongodb中的集群方案replicaset也实现了类似的算法。</p>
<h3 id="二、弱一致性"><a href="#二、弱一致性" class="headerlink" title="二、弱一致性"></a>二、弱一致性</h3><p>由于分布式系统在数据同步时的网络延迟等等因素，无法保证副本数据和主节点时刻保持一致，当出现不一致的时，可以采用以下几种策略保证最终一致性</p>
<p>Gossip（Cassandra，Dynamo），是带冗余容错算法，也就是最终一致性的算法，无法保证某时刻所有节点数据一致，它是一个去中心化的部署方式，集群中每个节点维护一组状态，状态可以用key,value，外带一个版本号表示，版本大的比版本小的数据新，节点之间相互交流数据的版本信息，并更新数据，类似病毒式的传递，这样数据可以达到最终一致。Cassandra就是采取这种策略来进行数据的同步,并且维护节点的健康状态。</p>
<p>Raft:</p>
<p>在一个由 Raft 协议组织的集群中有三类角色：</p>
<ul>
<li>Leader（领袖）</li>
<li>Follower（群众）</li>
<li>Candidate（候选人）<br>就像一个民主社会，领袖由民众投票选出。刚开始没有领袖，所有集群中的参与者都是群众，那么首先开启一轮大选，在大选期间所有群众都能参与竞选，这时所有群众的角色就变成了候选人，民主投票选出领袖后就开始了这届领袖的任期，然后选举结束，所有除领袖的候选人又变回群众角色服从领袖领导。这里提到一个概念「任期」，用术语 Term 表达。</li>
</ul>
<p>Leader选举阶段</p>
<p>1、至少有三个Candidate，因为要保证其中一个能获得多数票。</p>
<p>2、所有Candidate启动随机的定时器，timeout后，Candidate会先投自己一票，然后向其他人发送拉票申请。</p>
<p>3、Candidate收到其他人的拉票请求后，在没有投过票的情况下，给最早到达的拉票投票。</p>
<p>4、当一个Candidate获得多数票后，会宣布自己当选Leader，然后item+1，如果，没有一个节点当选，则执行随机退让算法，重新启动随机器，进行新的一轮投票，直到一个Candidate当选为止。</p>
<p>一致性的保证</p>
<p>1、client先向Leader发请求，Leader向所有Follower广播，当Leader收到半数的ack后，才向client回复ack。</p>
<p>2、保证Leader拥有最新的数据，当一个Follower挂掉回复以后，会接受Leader的日志同步。</p>
<p>3、当Leader挂掉以后，然后经过一定的心跳时间都没有回复的话，会进行新的选举，选出的新leader的任期要加1.</p>
<p>4、如果挂掉的Leader在选举期间的拉票请求广播被其他Candidate收到的时候，先检查任期，比当前任期小的Candidate一律不投票。</p>
<p>问题</p>
<p>1、脑裂问题，如果出现物理的网络分区现象，Leader存在的分区如果还是多数票则不会重新选举。新分区节点大于2会进行Leader选举。因此出现双Leader。但新分区的Leader的任期会比原Leader新，所以当网络恢复的时候，原Leader发现新的Leader的任期比自己新，会降级为Follower重新同步数据。</p>

                
            </div>
            <div class="continue">
            <a href="/2016/09/04/e5-88-86-e5-b8-83-e5-bc-8f-e4-b8-80-e8-87-b4-e6-80-a7-e7-ae-97-e6-b3-95/">
            Continue            <i class="fa fa-angle-right" aria-hidden="true"></i>
            </a>
            </div>
        </article>
        
        <article class="post">
            <h1>
                <a class="title" href="/2016/08/25/mysql-e6-89-a9-e5-b1-95-e5-ad-97-e6-ae-b5-e7-9a-84-e8-ae-be-e8-ae-a1/"> 
                    Mysql 扩展字段的设计 
                </a>
            </h1>
                        <div class="meta">
                <a class="date"> 
                    <i class="fa fa-calendar" aria-hidden="true"></i>                    
                    2016-08-25   
                </a>
                
                <a class="category">
                    <i class="fa fa-th" aria-hidden="true"></i>  
                </a>
               
                <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a></li></ul>
                
                    
            </div>
            <div class="content">
                
                <div>如果有大量的内容不好新建一个固定的字段，那我们可以采用扩展字段的方式来增加扩展性。</div><br><div></div><br><div>一般我们存储大量kv字符串会采用序列化例如“123||345||567”。</div><br><div></div><br><div>但是我们可以修改一下存储的形式，“||123||345||567||”</div><br><div></div><br><div>缺点：序列化后需要在两边补上分隔符，反序列化需要先删除两边的分隔符。（程序级别）</div><br><div></div><br><div>优点：可以方便like操作 ，例如我要获取扩展字段含有345的项。可以使用like %||345||%。（sql检索级别）</div>
                
            </div>
            <div class="continue">
            <a href="/2016/08/25/mysql-e6-89-a9-e5-b1-95-e5-ad-97-e6-ae-b5-e7-9a-84-e8-ae-be-e8-ae-a1/">
            Continue            <i class="fa fa-angle-right" aria-hidden="true"></i>
            </a>
            </div>
        </article>
        
        <article class="post">
            <h1>
                <a class="title" href="/2016/08/18/redis-e5-90-84-e7-a7-8d-e6-95-b0-e6-8d-ae-e7-b1-bb-e5-9e-8b-e7-9a-84-e4-bd-bf-e7-94-a8-e5-9c-ba-e6-99-af/"> 
                    Redis各种数据类型的使用场景 
                </a>
            </h1>
                        <div class="meta">
                <a class="date"> 
                    <i class="fa fa-calendar" aria-hidden="true"></i>                    
                    2016-08-18   
                </a>
                
                <a class="category">
                    <i class="fa fa-th" aria-hidden="true"></i>  
                </a>
               
                <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/nosql/">nosql</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/nosql/杂记/">杂记</a></li></ul></li></ul>
                
                    
            </div>
            <div class="content">
                
                <p>既然题目的是数据类型的使用场景。所以一些基本概念我就不说了。</p>
<h2 id="一、String"><a href="#一、String" class="headerlink" title="一、String"></a>一、String</h2><p>&nbsp;</p>
<p>1、利用INCR命令簇（<a href="http://redis.io/commands/incr" target="_blank" rel="noopener">INCR</a>, <a href="http://redis.io/commands/decr" target="_blank" rel="noopener">DECR</a>, <a href="http://redis.io/commands/incrby" target="_blank" rel="noopener">INCRBY</a>）来把字符串当作原子计数器使用。</p>
<p>2、使用<a href="http://redis.io/commands/append" target="_blank" rel="noopener">APPEND</a>命令在字符串后添加内容。</p>
<p>3、将字符串作为<a href="http://redis.io/commands/getrange" target="_blank" rel="noopener">GETRANGE</a> 和 <a href="http://redis.io/commands/setrange" target="_blank" rel="noopener">SETRANGE</a>的随机访问向量。</p>
<p>4、在小空间里编码大量数据，或者使用 <a href="http://redis.io/commands/getbit" target="_blank" rel="noopener">GETBIT</a> 和 <a href="http://redis.io/commands/setbit" target="_blank" rel="noopener">SETBIT</a>创建一个Redis支持的Bloom过滤器。</p>
<p>5、键值不宜过长，耗内存、查找成本高。</p>
<h2 id="二、List"><a href="#二、List" class="headerlink" title="二、List"></a>二、List</h2><p>1、Redis的List采用linked list实现。在头部或尾部插入效率为常数级别。</p>
<p>2、可以采用<a href="http://redis.io/commands/lpush" target="_blank" rel="noopener">lpush</a>、<a href="http://redis.io/commands/rpop" target="_blank" rel="noopener">rpop</a>实现一个简单的消息队列，用<a href="http://redis.io/commands/rpoplpush" target="_blank" rel="noopener">rpoplpush</a>命令把要出队的元素放入处理队列队尾，直到确认完成后，用lrem移除。</p>
<p>3、如果rpoplush的source和destination都是同一队列，此时便是旋转队列操作，可以模拟循环队列，用于多个客户端并行处理消息。</p>
<p>4、使用lpush与<a href="http://redis.io/commands/ltrim" target="_blank" rel="noopener">ltrim</a>保持列表长度，可以用于热点数据的保存。</p>
<p>5、博客的评论可以按发表时间进入列表，使用<a href="http://redis.io/commands/lrange" target="_blank" rel="noopener">lrange</a>进行分页。</p>
<p>6、使用lpop的阻塞版本<a href="http://redis.io/commands/blpop" target="_blank" rel="noopener">blpop</a>，可以防止客户端轮询消耗server的cpu资源。</p>
<h2 id="三、Hash"><a href="#三、Hash" class="headerlink" title="三、Hash"></a>三、Hash</h2><p>1、Redis的hash用作kv存储时，内存占用优于memcached的kv。</p>
<p>2、可以存储游戏的人物的属性，例如user:1000 nickname jack age 21</p>
<h2 id="四、Set"><a href="#四、Set" class="headerlink" title="四、Set"></a>四、Set</h2><p>1、由于Redis的set是没有重复元素的，所以可以用于元素的排重。</p>
<p>2、使用<a href="http://redis.io/commands/sinter" target="_blank" rel="noopener">sinter</a>求集合的交集，可以用于博客文章标签库的设计。</p>
<p>eg :   tag1 1 2 5  tag2 2 4 6 tag3 2 6 7 //三个标签存储着属于该标签的博客id</p>
<p>sinter tag1 tag2 tag3</p>
<p>2 //最后得到同时拥有三个标签的博客id</p>
<p>3、使用<a href="http://redis.io/commands/sunionstore" target="_blank" rel="noopener">sunionstore</a>可以快速的copy一个set。</p>
<p>4、使用spop可以随机pop出一个元素，用于设计需要产生随机数的系统，例如扑克牌游戏。如果不想元素出集合，使用<a href="http://redis.io/commands/srandmember" target="_blank" rel="noopener">srandmember</a>可以仅仅返回元素（随机）。此时返回的元素可能是重复的。</p>
<h2 id="五、Softed-set"><a href="#五、Softed-set" class="headerlink" title="五、Softed set"></a>五、Softed set</h2><p>1、内部的实现为跳跃表和hash表，所以添加元素的时间复杂度为O(log(n)).</p>
<p>2、可以用于排名榜系统，用<a href="http://redis.io/commands/zrange" target="_blank" rel="noopener">zrange</a>获取前n名的names，然后用<a href="http://redis.io/commands/zrank" target="_blank" rel="noopener">zrank</a> name获得排名。</p>
<p>3、使用<a href="http://redis.io/commands/zrangebyscore" target="_blank" rel="noopener">zrangebyscore</a>、<a href="http://redis.io/commands/zremrangebyscore" target="_blank" rel="noopener">zremrangebyscore</a>可以检索或移除指定区间内的元素。</p>
<h2 id="六、bitmap"><a href="#六、bitmap" class="headerlink" title="六、bitmap"></a>六、bitmap</h2><p>1、底层使用string来实现。大大地提高了利用效率，1byte=8bit。原本只能存512Mbyte的string现在能放2^32个bit。</p>
<p>2、bitcount可以用于大数据的区间计算。例如计算一天最长的访客区间，从00:00开始，每一个unix时间取偏移值<a href="http://redis.io/commands/setbit" target="_blank" rel="noopener">setbit</a>，最后<a href="http://redis.io/commands/bitcount" target="_blank" rel="noopener">bitcount</a>。</p>
<p>3、用于大数据的实时分析。</p>
<h2 id="七、HyperLogLogs"><a href="#七、HyperLogLogs" class="headerlink" title="七、HyperLogLogs"></a>七、HyperLogLogs</h2><p>1、用于大数据的允许误差的基数运算，用set实现的区别为，HyperLogLogs并不会储存具体的元素，不管元素有多少，最坏情况下只需12kbyte就能完成运算，误差为1%。例如用户每天的搜索量。</p>
<h2 id="八、参考"><a href="#八、参考" class="headerlink" title="八、参考"></a>八、参考</h2><p>【1】<a href="http://redis.io/topics/data-types-intro" target="_blank" rel="noopener">data-types-intro</a></p>

                
            </div>
            <div class="continue">
            <a href="/2016/08/18/redis-e5-90-84-e7-a7-8d-e6-95-b0-e6-8d-ae-e7-b1-bb-e5-9e-8b-e7-9a-84-e4-bd-bf-e7-94-a8-e5-9c-ba-e6-99-af/">
            Continue            <i class="fa fa-angle-right" aria-hidden="true"></i>
            </a>
            </div>
        </article>
        
        <article class="post">
            <h1>
                <a class="title" href="/2016/08/16/redis-vs-memcached-vs-mongodb/"> 
                    Redis-vs-Memcached-vs-MongoDB 
                </a>
            </h1>
                        <div class="meta">
                <a class="date"> 
                    <i class="fa fa-calendar" aria-hidden="true"></i>                    
                    2016-08-16   
                </a>
                
                <a class="category">
                    <i class="fa fa-th" aria-hidden="true"></i>  
                </a>
               
                <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/nosql/">nosql</a></li></ul>
                
                    
            </div>
            <div class="content">
                
                <h2 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h2><p>redis、memcached、mongodb这个三个系统现在使用广泛。做一个后端工程师对他们必然要有一定的认识，下面我翻译了一个图表进行简单说明。</p>
<h2 id="二、正文"><a href="#二、正文" class="headerlink" title="二、正文"></a>二、正文</h2><table width="100%"><br><tbody><br><tr><br><td class="attribute">名称</td><br><td class="header">Memcached</td><br><td class="header">MongoDB</td><br><td class="header">Redis</td><br></tr><br><tr><br><td class="attribute">简述</td><br><td class="value">全内存的kv存储, 最初设计用于缓存</td><br><td class="value">最流行的文档型数据库</td><br><td class="value">全内存的结构数据存储，可用于数据库，缓存，消息代理。<br><br>Redis专注于性能，所以它的很多设计都把高性能、低延迟放在第一位。</td><br></tr><br><tr><br><td class="attribute">数据库模型</td><br><td class="value">k-v 存储</td><br><td class="value">文档型数据库</td><br><td class="value">k-v存储<br><br>众多的数据类型、丰富的操作集、可配置的数据过期时间，历史数据回收和数据持久</td><br></tr><br><tr><br><td class="attribute"></td><br><td class="value"></td><br><td class="value"></td><br><td class="value"></td><br></tr><br><tr><br><td class="attribute">官网</td><br><td class="value"><a href="http://www.memcached.org/" target="_blank" rel="noopener">www.memcached.org</a></td><br><td class="value"><a href="http://www.mongodb.org/" target="_blank" rel="noopener">www.mongodb.org</a></td><br><td class="value"><a href="http://redis.io/" target="_blank" rel="noopener">redis.io</a></td><br></tr><br><tr><br><td class="attribute">技术文档</td><br><td class="value"><a href="https://github.com/memcached/memcached/wiki" target="_blank" rel="noopener">github.com/­memcached/­memcached/­wiki</a></td><br><td class="value"><a href="http://docs.mongodb.org/manual/" target="_blank" rel="noopener">docs.mongodb.org/­manual</a></td><br><td class="value"><a href="http://redis.io/documentation" target="_blank" rel="noopener">redis.io/­documentation</a></td><br></tr><br><tr><br><td class="attribute">开发者</td><br><td class="value">Danga Interactive</td><br><td class="value">MongoDB, Inc</td><br><td class="value">Salvatore Sanfilippo</td><br></tr><br><tr><br><td class="attribute">初次发布</td><br><td class="value">2003</td><br><td class="value">2009</td><br><td class="value">2009</td><br></tr><br><tr><br><td class="attribute">最新发行版</td><br><td class="value">1.4.29, July 2016</td><br><td class="value">3.2.8, July 2016</td><br><td class="value">3.2.3, August 2016</td><br></tr><br><tr><br><td class="attribute">证书</td><br><td class="value">BSD开源协议</td><br><td class="value">AGPL 第三版开源协议， 提供商业版证书</td><br><td class="value">BSD 3-条款，提供商业版证书</td><br></tr><br><tr><br><td class="attribute">数据库服务</td><br><td class="value">不提供</td><br><td class="value">不提供</td><br><td class="value">不提供</td><br></tr><br><tr><br><td class="attribute">实现语言</td><br><td class="value">C</td><br><td class="value">C++</td><br><td class="value">C</td><br></tr><br><tr><br><td class="attribute">支持的服务器端os</td><br><td class="value">FreeBSD<br>Linux<br>OS X<br>Unix<br>Windows</td><br><td class="value">Linux<br>OS X<br>Solaris<br>Windows</td><br><td class="value">BSD<br>Linux<br>OS X<br>Windows</td><br></tr><br><tr><br><td class="attribute">数据模式</td><br><td class="value">schema-free</td><br><td class="value">schema-free</td><br><td class="value">schema-free</td><br></tr><br><tr><br><td class="attribute">数据类型</td><br><td class="value">没有</td><br><td class="value">string, integer, double, boolean, date, object_id</td><br><td class="value">支持的数据类型：strings, hashes, lists, sets and sorted sets, bit arrays, hyperloglogs and geospatial indexes</td><br></tr><br><tr><br><td class="attribute">XML 支持</td><br><td class="value"></td><br><td class="value"></td><br><td class="value">不</td><br></tr><br><tr><br><td class="attribute">第二索引</td><br><td class="value">不支持</td><br><td class="value">支持</td><br><td class="value">不支持</td><br></tr><br><tr><br><td class="attribute">SQL</td><br><td class="value">no</td><br><td class="value">no</td><br><td class="value">no</td><br></tr><br><tr><br><td class="attribute">APIs 和其他通信协议</td><br><td class="value">专有协议</td><br><td class="value"> 使用 JSON</td><br><td class="value">专有协议</td><br></tr><br><tr><br><td class="attribute">客户端支持的语言</td><br><td class="value">.Net<br>C<br>C++<br>ColdFusion<br>Erlang<br>Java<br>Lisp<br>Lua<br>OCaml<br>Perl<br>PHP<br>Python<br>Ruby</td><br><td class="value">Actionscript （非官方）<br>C<br>C#<br>C++<br>Clojure（非官方）<br>ColdFusion（非官方）<br>D（非官方）<br>Dart（非官方）<br>Delphi（非官方）<br>Erlang<br>Go（非官方）<br>Groovy（非官方）<br>Haskell<br>Java<br>JavaScript<br>Lisp（非官方）<br>Lua（非官方）<br>MatLab（非官方）<br>Perl<br>PHP<br>PowerShell（非官方）<br>Prolog（非官方）<br>Python<br>R（非官方）<br>Ruby<br>Scala<br>Smalltalk （非官方）</td><br><td class="value">C<br>C#<br>C++<br>Clojure<br>Crystal<br>D<br>Dart<br>Elixir<br>Erlang<br>Fancy<br>Go<br>Haskell<br>Haxe<br>Java<br>JavaScript (Node.js)<br>Lisp<br>Lua<br>MatLab<br>Objective-C<br>OCaml（非官方）<br>Perl<br>PHP<br>Prolog<br>Pure Data<br>Python<br>R<br>Rebol<br>Ruby<br>Rust<br>Scala<br>Scheme<br>Smalltalk<br>Tcl</td><br></tr><br><tr><br><td class="attribute">服务器端脚本</td><br><td class="value">不支持</td><br><td class="value">JavaScript</td><br><td class="value">Lua</td><br></tr><br><tr><br><td class="attribute">触发器</td><br><td class="value">no</td><br><td class="value">no</td><br><td class="value">no</td><br></tr><br><tr><br><td class="attribute">分区方式</td><br><td class="value">没有分区</td><br><td class="value">分片</td><br><td class="value">分片</td><br></tr><br><tr><br><td class="attribute">副本方式</td><br><td class="value">Repcached（高可用方案）</td><br><td class="value">主从复制</td><br><td class="value">主从复制</td><br></tr><br><tr><br><td class="attribute">接入MapReduce</td><br><td class="value">不支持</td><br><td class="value">支持</td><br><td class="value">不支持</td><br></tr><br><tr><br><td class="attribute">一致性</td><br><td class="value"></td><br><td class="value">最终一致、实时一致</td><br><td class="value">最终一致</td><br></tr><br><tr><br><td class="attribute">外键</td><br><td class="value">不支持</td><br><td class="value">通常不使用</td><br><td class="value">不支持</td><br></tr><br><tr><br><td class="attribute">事务</td><br><td class="value">不支持</td><br><td class="value">在同一的Document里面提供原子性</td><br><td class="value">乐观锁，命令具有原子性</td><br></tr><br><tr><br><td class="attribute">并发</td><br><td class="value">支持</td><br><td class="value">支持</td><br><td class="value">支持，数据序列化存储</td><br></tr><br><tr><br><td class="attribute">持久化</td><br><td class="value">不支持</td><br><td class="value">支持（可选）</td><br><td class="value">支持（RDB、AOF）</td><br></tr><br><tr><br><td class="attribute">数据存在内存</td><br><td class="value"> 支持</td><br><td class="value">3.2以后支持</td><br><td class="value">支持</td><br></tr><br><tr><br><td class="attribute">用户鉴权</td><br><td class="value">使用 SASL (Simple Authentication and Security Layer) 协议</td><br><td class="value">基于角色的权限控制RBAC（Roles-based  Access Control）</td><br><td class="value">基于用户密码的认证，商业版支持ssl和访问控制</td><br></tr><br><tr><br><td class="headline" colspan="99"></td><br></tr><br></tbody><br></table>

<h2 id="三、小结"><a href="#三、小结" class="headerlink" title="三、小结"></a>三、小结</h2><p>通过上面表格应该大致了解三个系统的大致区别，不过这只是皮毛，以后我会去更多去探讨他们在一致性，副本、持久化方面的实现来进一步了解他们的设计理念。</p>
<h2 id="四、摘录"><a href="#四、摘录" class="headerlink" title="四、摘录"></a>四、摘录</h2><p>【1】<a href="http://db-engines.com/en/system/Memcached%3BMongoDB%3BRedis" target="_blank" rel="noopener">System Properties Comparison Memcached vs. MongoDB vs. Redis</a></p>

                
            </div>
            <div class="continue">
            <a href="/2016/08/16/redis-vs-memcached-vs-mongodb/">
            Continue            <i class="fa fa-angle-right" aria-hidden="true"></i>
            </a>
            </div>
        </article>
        
</section>

  <nav class="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

    </main>
    <a class="not-found">not found!</a>
    <div class="search-items">
    </div>
    <a href="#header" id="top" style="display:none">
        <i class="fa fa-sort-asc fa-2x"></i>
    </a>
    <footer class="footer">
    <div class="footer-copyright">©️2017
    <a href="//github.com/Vevlins/toki" class="link" target="_blank">Toki</a>  by Vevlins
    </div>
</footer>

    <script src="/js/jquery.js"></script>
    <script src="/js/toki.js"></script>  
  <script>hljs.initHighlightingOnLoad();</script>
</body>
</html>